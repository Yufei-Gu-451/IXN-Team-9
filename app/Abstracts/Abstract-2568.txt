An outstanding challenge in protein folding is understanding the origin of "internal friction" in folding dynamics, experimentally identified from the dependence of folding rates on solvent viscosity. A possible origin suggested by simulation is the crossing of local torsion barriers. However, it was unclear why internal friction varied from protein to protein or for different folding barriers of the same protein. Using all-atom simulations with variable solvent viscosity, in conjunction with transition-path sampling to obtain reaction rates and analysis via Markov state models, we are able to determine the internal friction in the folding of several peptides and miniproteins. In agreement with experiment, we find that the folding events with greatest internal friction are those that mainly involve helix formation, while hairpin formation exhibits little or no evidence of friction. Via a careful analysis of folding transition paths, we show that internal friction arises when torsion angle changes are an important part of the folding mechanism near the folding free energy barrier. These results suggest an explanation for the variation of internal friction effects from protein to protein and across the energy landscape of the same protein.