How does the brain orchestrate perceptions, thoughts, and actions from the activity of its neurons? Addressing these challenging questions requires methods capable of isolating, identifying and manipulating statistically representative fractions of the neurons of the investigated circuits at single-neuron and single-spike resolution during behavior (Alivisatos et al., 2013;Buzsaki, 2004;Carandini, 2012;Marblestone et al., 2013;Nicolelis et al., 1997). Electrical recording of extracellular action potentials ('spikes') is among the oldest neuronal recording techniques (Adrian and Moruzzi, 1939) and its physical principles are well understood (Buzsaki et al., 2013;Einevoll et al., 2013;Logothetis, 2003;Nadasdy Z. et al., 1998). Electrical recordings have the additional advantage of simultaneously detecting the superimposed synaptic activity of neurons in the form of local field potentials (LFPs). While the number of simultaneously-recorded neurons has doubled every seven years over the past several decades (Stevenson and Kording, 2011), the widespread adoption of large-scale recording methods by the neuroscience community has generally lagged behind. However, significant recent technological innovations are now bringing large-scale recording methods into the mainstream, thereby enabling progressively more advanced experiments and analyses - and associated challenges. To meet the expectations of the BRAIN Initiative (http://www.nih.gov/science/brain/), this trend of innovation coupled with translation over multiple technologies becomes increasingly important. Relating the activity patterns of circuit components to behavior is a powerful method for inferring their role in organizing behavior. Testing their causal role, however, requires additional steps. Optogenetics has recently emerged as the appropriate method for fast manipulation of genetically identified neuron types. While optogenetic methods have the sufficient temporal speed for interacting with neuronal circuits, their spatial resolution in currently used instantiations is typically very poor. Another limitation is the lack of multisite light delivery methods for flexible circuit control in freely behaving small rodents. Thus, new techniques are needed to validate hypotheses derived from the correlation measures between the spatiotemporal coordination of neurons and behavior. To harness the maximum potential of combining large-scale recording methods, progressive innovation is needed at various levels of device integration. Our Primer focuses on technologies developed for small-size animals. However, the discussed methods can be adapted to non-human primates as well, and several recent innovations with specific solutions for primates have been reviewed recently (Cavanaugh et al., 2012;Diester et al., 2011;Gerits et al., 2012;Gray et al., 2007). Three issues are addressed: (I) state-of-art current methods and barriers, (II) approaches to make the current upper limit more accessible to mainstream neuroscience, and (III) a look ahead to technology innovations required to increase the upper limit of recording sites by one or two orders of magnitude. A flow chart of large-scale recording and the closed-loop targeted feedback perturbation of neurons in their native networks is illustrated inFigure 1. Neuronal activity gives rise to transmembrane current and the superposition of multiple potentials spreading through the extracellular medium can be measured as voltage (Ve) , referred to as local field potential (LFP). The somato-dendritic tree of the neurons forms an electrically conducting interior surrounded by a highly insulating membrane with hundreds to thousands of synapses located along it. They can conduct either inward (excitatory) or outward (hyperpolarizing, most often inhibitory) currents. The amplitude and time-varying patterns of the LFP depend on the proportional contributions of the multiple current sources and are modified by the various properties of the brain tissue (Buzsaki et al., 2012;Einevoll et al., 2013). Because the amplitude ofVeinversely scales with the distance between the source and the recording site, the larger the distance, the less informative is the measured LFP regarding its origin. Action potentials generate the largest-amplitude currents across the somatic membrane and can be detected as extracellular 'unit' or spike activity. In addition to the distance between the neuron and the recording electrode, the magnitude of the extracellular spike depends on the size and shape of the neuron (Buzsaki et al., 2012;Einevoll et al., 2013). Extracellular spikes are negative near the soma (sink), corresponding to the fastest rate of Na+influx into the cell body (Figure 2). In cortical structures, the bodies and apical dendrites of densely-packed pyramidal neurons lie parallel to each other, making the separation of neurons on the basis of their extracellular spikes difficult. On the other hand, such architecturally regular geometry is favorable for estimating afferent-induced synaptic inputs to the circuit since afferents in cortical layers run perpendicular to the dendritic axis, and this arrangement facilitates the combination of synchronously active synaptic/transmembrane currents by superposition (Figure 2B). In summary, both identification of spikes of different neurons and the inference of population synaptic activity from the extracellular voltage require high-resolution spatiotemporal sampling of the extracellular space, ideally equal to or smaller than the diameter of neuronal cell bodies. Action potentials can be detected as voltage by placing a conductor, such as a wire, in close proximity to the neuron (Adrian and Moruzzi, 1939). Because neurons of the same class generate largely identical action potentials, identifying an individual neuron from its extracellular spikes is possible by moving the electrode tip substantially closer to the cell body of one neuron than to the neighboring neurons. To record another neuron or dissociate the spike signals of two different nearby neurons, more than one electrode is needed. The use of two or more recording sites in close proximity allows for the triangulation of distances between the spike-emitting cell bodies and the electrodes because the spike amplitude waveform morphology changes as a function of distance and direction from the neuron (Drake et al., 1988). Often, this task is accomplished with two or four twisted wires (dubbed "stereotrodes' or "tetrodes"; (McNaughton et al., 1983;Wilson and McNaughton, 1993). Ideally, the tips are separated in three-dimensional space so that the point-source localization of several neurons is possible (Drake et al., 1988;Perlin and Wise, 2004;Wilson and McNaughton, 1993). Typical types of wire tetrodes can "hear" hippocampal CA1 pyramidal cells in rats as far as 140 um laterally. A cylinder with this radius contains ?1000 neurons, which is the number of cells theoretically recordable by a single tetrode (Henze et al., 2000); these estimates vary by neuron size, type and brain region). Yet, in practice, only 5-15 neurons can be reliably separated in limited-duration recordings. The low firing-rates of many neurons (Buzsaki and Mizuseki, 2014;Schwindel et al., 2014;Shoham et al., 2006), as well as low amplitudes of the majority of detected spikes (Fig. 2; less than 40 uV; (Schomburg et al., 2012) preclude a reliable neuron isolation with currently available clustering algorithms (Harris et al., 2000). Furthermore, mechanical damages associated with probes movements may damage neuronal processes, or tear small vessels (Claverol-Tinture and Nadasdy, 2004;Kozai et al., 2010;Seymour and Kipke, 2007;Tsai et al., 2009). Electrical recording from neurons is invasive. Therefore, the desire for large-scale monitoring of neurons with many recording sites in a small volume and the desire to minimize the tissue damage inflicted by the electrodes compete with each other (Scott et al., 2012). Micro-Electro-Mechanical System (MEMS)-based recording devices can reduce the technical limitations inherent in wire electrodes because with the same amount of tissue displacement, the number of monitoring sites can be substantially increased (Kipke et al., 2008;Najafi and Wise, 1986), and a tapered tip is readily achieved. Most micromachined electrode arrays ('silicon probes';Fig. 3) are formed by photolithographic patterning of thin films of conductors and insulators on silicon substrate. Such a fabrication process allows tailoring the size, shape and the arrangement of the electrodes according to the neural density and local circuit architecture of a specific brain region. Advances in lithography, metal deposition procedures and quality control, an ever-growing number of probe architectures have been developed over the years to meet experiment-guided specific requirements (Bartels et al., 2008;Hofmann et al., 2006;Jamille and David, 2002;Ludwig et al., 2006;McCreery et al., 2006;Motta and Judy, 2005;Musallam et al., 2007;Neves and Ruther, 2007;Nordhausen et al., 1996;Rennaker et al., 2005;Seidl et al., 2011;Wise et al., 2004). The resulting silicon devices enable high-density LFP recordings and large-scale single unit recordings in a variety of brain structures and species (Fig. 4; (Agarwal et al., 2014;Bartho et al., 2004;Blanche et al., 2005;Broome et al., 2006;Csicsvari et al., 2003;Du et al., 2011;Fujisawa et al., 2008;Lin et al., 2014;Montgomery et al., 2008;Pouzat et al., 2002)). Further advances in the electrode design and arrangement require to push beyond existing technology capabilities to achieve higher recording densities. One of these is the need to reduce probe dimensions to enable probe designs of about the same size, but having significantly more electrode sites. Such a goal is limited mainly by the width of the embedded conductive leads (also called traces or interconnects) that are needed to connect each electrode site to an extracranial bond pad for connection to the external electronics interface. Experience in rodents suggests that when the width of the probe shanks is wider than greater than 60 um (assuming a shank thickness less than 20 um), the unit recording quality of the probe decreases rapidly, perhaps due to compression or damage to the dendrites of the surrounding neurons (Claverol-Tinture and Nadasdy, 2004). There is a viable technology roadmap for developing next-generation fine-featured probes for high-resolution recording. One approach involves incremental advances in current MEMS microfabrication processes that result in smaller minimum feature sizes. A related approach involves using alternative MEMS technologies that intrinsically support finer features, e.g., electron-beam lithography (Du et al., 2011). A third MEMS-based approach is to integrate active electronic components in the probe shanks to provide electronic switching that reduces the lead count, and thereby reduces the required shank dimensions (Seidl et al., 2011). Efforts are under way to manufacture a single-shank (50 um wide) probe with up to 960 closely-spaced (20 um) contacts, of which 384 can be selected for simultaneous recording at a given time (HHMI-Allen Institute-Gatsby Foundation-Wellcome Trust Consortium), thus enabling more powerful experimental approaches to understanding the interaction of neurons and neuronal pools. A non-MEMS approach is to use small diameter (less than 7 microns), parylene coated carbon fibers to create fine-featured microelectrode arrays having large numbers of ultra-small microlectrodes (Kozai et al., 2012). A second advance in probe design space is to optimize shank geometry and recording site positions for maximal dense local sampling of neurons, which is important for capturing the dynamics of neuronal ensembles with complex connectivity patterns. In particular, one goal is to minimize the "backside shielding" effect of typical planar silicon probes that have electrode sites all on one side (the "topside"; (Moffitt and McIntyre, 2005)). One design approach for minimizing backside shielding is to locate electrode sites at or near the edge of the shank, perhaps in concert with additional sites located off the edge (Seymour et al., 2011). An alternative approach is to extend planar architectures to manufacture double-sided electrodes (Du et al., 2009;Perlin and Wise, 2004). A third design space opportunity is three-dimensional microelectrode arrays, which, in principle, offer high-resolution functional mapping of local circuits (Wise et al., 2008). Experiments indicate that with three-dimensional triangulation the source localization of neurons can precise as 17 um (Du et al., 2009). Three-dimensional electrode arrays present a difficult technical challenges involving advanced hermetic packaging having micron-level precision, complex lead transfers for hundreds of leads, and sophisticated surgical techniques, combined with important practical needs for reliability and manufacturability (Bai et al., 2000;Hoogerwerf and Wise, 1994;Neves and Ruther, 2007;Pang et al., 2005;Perlin and Wise, 2010;Yao et al., 2007). Furthermore, inserting three-dimensional probes into the vessel-rich neocortex (Tsai et al., 2009) without compromising the neuropil will remain a serious challenge. The above discussion of probe geometry can help estimate the optimal configuration of future probes and the maximum yield of simultaneously recordable neurons. For the purpose of recording and separating the maximum number of neurons, the recording sites should tile the entire shank surface of the probe, which should, in turn, have minimal dimensions. Putting aside the problem of interconnects for a moment, and assuming the need for at least 8*8 um2recoding sites with 10 um center-to-center separation, 200 sites per shank on a 20-um wide probe can cover the entire cortical gray matter ( less than 2 mm). Adding recording sites on both sides would double the number of monitoring sites and increase the unit yield (Du et al., 2009). Placing three shanks in less than =100 um triangle would allow effective three-dimensional triangulation of cortical neurons in all cortical layers. Such a probe could, in principle, record from between 1000 to 5000 neurons and determine the three-dimensional position of both cell bodies and the main dendrites of each neuron. These technical improvements are within reach but will require high-density off-chip lead transfers, probably in conjunction with on-probe circuitry (Al-Ashmouny et al., 2012;Bai and Wise, 2001;Perlin and Wise, 2010;Wise et al., 2004). We should emphasize that even slim-shank probes come at the expense of tissue damage, fractional displacement volume and associated disruption of physiological activity that needs to be carefully investigated (Claverol-Tinture and Nadasdy, 2004;Polikov et al., 2005;Tsai et al., 2009)Unfortunately, there is not a 'one fit for all' solution for probe design. Various neuron types have different sizes, dendritic configurations and densities and require 'custom-fit' probes for effective neuron isolation. This area of research could benefit tremendously from appropriate modeling of the extracellular space populated with realistic neuron geometries (Reimann et al., 2013), glia and vessels and physiological spiking patterns. In turn, virtual electrodes could be embedded into such a 'neuron cube' to identify the most appropriate probe geometry, recording site configurations and neuron shielding effects. Such a neuron cube model could also offer 'ground truth' for the neuron-spike identity problem and be exploited for perfecting unit clustering algorithms. Major questions in neuroscience address circuit changes and stability over extended time periods, and dealing with such problems presents important challenges for long-term, high-quality unit recordings. Although several laboratories have reported extended recordings for weeks and even months with diverse types of microelectrodes in various species (Chestek et al., 2011;Jackson and Fetz, 2007;Kipke et al., 2003;Nicolelis et al., 1997;Rousche and Normann, 1998;Ruther et al., 2011;Suner et al., 2005), chronic performance of electrodes, to date, is unpredictable and highly variable. A major cause of probe failure over time is mechanical instability and neuron damage. Ultra-thin, and flexible probes can alleviate the mechanical damage associated with probe penetration by reducing the mechanical mismatch between probe and brain tissue, and allow the probe to move with the adjacent tissue and neurons (Bjornsson et al., 2006). Biodegradable materials, such as silk fibroin, patterned on Parylene substrate, can provide sufficient mechanical support for the probes to be inserted in the brain, while allowing free-flotation of the flexible probe after the silk layer is absorbed (Kim et al., 2010)(Tien et al., 2013). There is a tremendous need to improve the electrode/tissue interface to enhance the signal-to-noise ratio (SNR) and increase the yield of neurons per recording session. Conducting polymers such as PEDOT:PSS are used to decrease the electrochemical impedance mismatch between electrode and brain tissue interface and further reduce the chronic reactive tissue response (Abidian and Martin, 2008;Ludwig et al., 2006;Shain et al., 2003;Spataro et al., 2005). Combining electrical recordings with local delivery of electrical stimulation, chemical substances, such as neurotransmitters, and light for optogenetics (see below) will play an growing role in the exploration of neural circuit mechanisms (Chen et al., 1997;Cheung et al., 2003;Li et al., 2007;Seidl et al., 2011;Seidl et al., 2010). Penetrating probes can isolate multiple single-neurons from any structure. However, increasing the number of shanks per probe can cause irreversible damage to brain tissue limiting the monitoring of large-scale neural dynamics occurring over contiguous areas of cortex. An emerging approach is to use surface electrodes. The NeuroGrid is an organic material-based, ultraconformable, biocompatible and scalable neural interface device that can acquire both LFPs and spikes from superficial cortical neurons without penetrating the brain surface (Khodagholy et al., 2014). The device is fabricated from "soft organic" material to allow conformation of the probe on the curvilinear surface of the brain, as well as improving the efficiency of ion to electron conversion (Khodagholy et al., 2011). In concert with advances in microelectronics and data processing such as CMOS technologies used in Multi-Electrode Arrays (MEAs) that can yield several thousands recordings sites, LFP and spike samples recorded by the NeuroGrid can be substantially increased (Hutzler and Fromherz 2004)(Lei et al., 2011;Muller et al., 2012) (Chichilnisky and Baylor, 1999;Meister et al., 1994). Implanted and 'fixed'-depth electrodes have good mechanical stability but their unit yield is low. During surgical anesthesia the brain expands and shrinks, and therefore even precisely-placed electrodes move their position relative to neuronal bodies. An effective way of increasing unit yield is to place the electrodes several hundred um above the target area and move them slowly ( less than 100 um steps a day) by a microdrive. The unproven assumption of this practice is that moving the shank tips so slowly, the neurons, glia and vasculature have time to move away and rebuild (Fujisawa et al., 2008). Advancement of the electrode can be achieved by microdrives (Fee and Leonardo, 2001;Vandecasteele et al., 2012;Wilson and McNaughton, 1993;Yamamoto and Wilson, 2008). The key requirements of a microdrive are precision, mechanical stability and minimal size and weight. Drives add addition weight and volume to the head-gear and are seriously limiting factors in experiments that require free movement of small rodents. In our experience, a head implant totaling 10% of the preoperative body weight does not impede free behavior. Assuming an adult weight of a 30-g mouse, the package weight budget should be less than 3 g, although for many experiments the weight should be even less. Any small drift ( less than 10 um) between the electrode tip and the neuron(s) can affect recording stability. Such drifts are typically brought about by headshakes, intense grooming, banging the head stage against cage walls and, importantly, during plugging and unplugging the head connectors. The latter problem can be reduced significantly if the microdrive, containing the electrodes, is physically separated from the head connector by a flexible interconnect cable. Polyimide cables have been used successfully for such purpose because of their flexibility and integrated design with silicon probes (Berenyi et al., 2014;Stieglitz et al., 2005) (NeuroNexus Inc.). Cables can also be fabricated as an integral part of the probe so that bonds are required only at the connector end (Yao et al., 2007). With high site-count probes, however, there are still remaining challenges. Higher-density bonding technologies are needed to permit lead transfers on 20um centers, and traditional connectors with 100 sites and thick cables are not practical for freely behaving small rodents. On-site multiplexing is one solution but size, weight and cost factors must be considered. A critical aspect of miniaturization is the deployment of signal multiplexers. Earlier versions of multiplexers had either low channel counts or limited high- or low-pass frequency characteristics for simultaneous recordings of both unit and LFP signals in the physiological range and required de-multiplexing and digitization of the transmitted multiplexed analog signals (Berenyi et al., 2014;Du et al., 2011;Harrison, 2008;Olsson et al., 2005;Szuts et al., 2011;Viventi et al., 2011). The recent availability of small size 32- and 64-channel digital multiplexers (RHD-2132 or RHD-2164 chip or die; Intan, Inc.) has accelerated the spread of high-channel-count recordings in physiological laboratories. The digital output of the signal multiplexers (Harrison, 2008) allows direct streaming of the neurophysiological data to the computer. Despite important advances in miniaturization, high-channel-count recordings ( greater than 100) in behaving mice and other small animals still remain a challenge because routing the probe sites to the inputs of the signal multiplexers still requires large connectors. Placing headstages permanently on the head of the animal (Berenyi et al., 2014) is an alternative but expensive solution and they add unwanted volume and weight. Given that only 15% of the weight of the functional 64-site electrode system comes from the digitizing headstage integrated circuit (the bulk coming from the printed-circuit board, connector, and sealing epoxy), the most significant development step in packaging and electronics towards a 1,000 site recording system usable in a behaving mouse would be a next-generation integrated circuits that would support larger numbers of channels and that could be intimately packaged with a high-density neural probe (Lei et al., 2011). An ideal solution to size reduction is integrating the signal amplifiers and multiplexers to the probe end (Csicsvari et al., 2003;Olsson et al., 2005) or into the flexible interconnect cable. The current limitation of such improvement is the high cost of design and fabrication, which can exceed several million dollars. In principle, the active circuits can be placed on the probe shanks, effectively reducing the number of interconnects between the recording sites and electronics outside the brain. However, active circuits also occupy volume and limit the number of recording sites. Experience dictates that any structure greater than 60 um wide deteriorates the recording ability of probes. Furthermore, such brain-embedded circuits must operate at low enough power levels so that significant heating of the probe is avoided since heating can impact local neurons. Active circuits must also be electrically shielded or located such that the electric fields generated by the circuit components do not influence the spiking activity of nearby neurons (Jefferys, 1995). Cables interconnecting the head stage and the recording system can be completely eliminated by telemetry or data loggers. While up to 128-channel telemetry systems have been successfully used in small animals (Greenwald et al., 2011;Harrison et al., 2011;Sodagar et al., 2007;Szuts et al., 2011), cable connections allows much higher bandwidth, higher channel counts and lower noise. On-probe multiplexing followed by analog-to-digital conversion, thresholding, and data compression can make use of the relatively sparse nature of neural recordings to boost the channel capacity by well over an order of magnitude in some situations (Olsson et al., 2005). Data loggers present another solution for specific applications, such as studying underground, underwater behaviors, social interactions or flying (Yartsev and Ulanovsky, 2013). Unfortunately, the power source required for telemetry adds additional weight and limits the duration of the experiments, while less power-intensive data loggers do not allow the experimenter to monitor the recorded data during the experiments. A combination of these two approaches may optimize their cost-benefit by storing all data on a data logger, and transmitting a few user-selected channels, when needed, via a telemeter and allowing bidirectional communication perturbation of circuits and recording (see below). Externally powered devices (Wentz et al., 2011) may provide solutions for long-term wireless interfacing. Recent rapid progress with on-head digital multiplexing (Harrison, 2008) and direct streaming of the neurophysiological data to the computer has made high-density recordings affordable even for small laboratories. Community-driven improvement of shared software (e.g.,klustaviewas@googlegroups.com;http://neuroscope.sourceforge.net/;http://klusta-team.github.io/klustakwik/;http://open-ephys.org/) is expected to provide new solutions for flexible data display and fast processing of the recorded physiological and behavioral data for closed-loop interactions with brain circuits. These include on-line detection of particular LFP and unit firing patterns of isolated single spikes, bursts or arbitrary combinations of multiple site spike timing relationships associated with any chosen aspect of behavior or spatial localization of the animal to drive instantaneous feedback perturbation of multiple single neurons or sites (Stark et al., 2012). On-line or real-time processing of even complex neural data is becoming feasible by microprocessors and field-programmable gate arrays (FPGAs; (Muller et al., 2012) ). The recent advent of optogenetics (Boyden et al., 2005;Deisseroth, 2011;Zemelman et al., 2002) provides a solution for identifying specific, genetically-defined neuronal subtypes in blind extracellular recordings by expressing light-sensitive opsins in a given neuronal population. Both activation and silencing strategies can be used for this purpose. Several laboratories have offered solutions for optical stimulation of local circuits combined with simultaneous neuronal recordings (Cardin et al., 2010;Halassa et al., 2011;Han et al., 2009;Kim et al., 2013;Kravitz et al., 2010;Lu et al., 2012;Rubehn et al., 2013;Voigts et al., 2013;Zhang et al., 2009). However, a number of technical issues must be addressed to exploit the full potential of combined large-scale recording and optogenetics, including local delivery of low-intensity light, application of appropriate stimulus waveforms, and replacement of large benchtop lasers with small head-mounted LEDs or laser diodes (see below). Integrated recording-optogenetic methods can be used to accomplish at least three goals: (a) identification of genetically labeled neurons (optical 'tagging'), (b) physiological characterization and classification of neuron types and (c) testing the causal roles of the identified neurons in the performance of local circuits. The optogenetic method can, in principle, be used to distinguish cortical principal cells from interneurons, identify neurons with specific neuromodulators (Madisen et al., 2012) and differentiate physiologically similar neurons projecting to different targets (Packer et al., 2013). The rapidly growing Cre mouse (Madisen et al., 2012;Taniguchi et al., 2011) and rat (Witten et al., 2011) lines, intersection virus methods (Gradinaru et al., 2010) and other novel ways of marking neurons pave the way to ever more precise definitions of neuronal identity (Packer et al., 2013;Scanziani and Hausser, 2009). However, because neurons are both embedded in circuits and contribute to circuit function, their perturbation can bring about secondary changes, which need to be separated from the primary action of optical stimulation (Fig. 5). On the one hand, variable expression levels of opsins can yield false negative effects. On the other hand, indirect in/activation of neurons can arise from an undesirable recruitment of non-tagged neurons by trans-synaptic effects. Optogenetic activation of principal neurons by light pulses can discharge their partner interneurons (Csicsvari et al., 1998;Miles, 1990) and, potentially other principal cells at short latency and high fidelity. Separation of directly and indirectly driven neurons by latency criteria is highly unreliable (Kvitsiani et al., 2013). Silencing principal cells suffer from the same technical problems since the connected partners can also decrease their rates. Optogenetic activation of inhibitory interneurons can induce a robust rate increase in the directly activated interneurons and suppressed spiking or no-change in the remaining neurons. Yet strong inhibition, brought about by strong light and synchronously discharging interneurons, may bring about rebound spiking in principal cells and possibly other interneurons (Fig. 5C; (Stark et al., 2013)). Tagging of inhibitory interneurons by optogenetic silencing is more reliable than by their activation, although disynaptic disinhibition can mediate rate decrease in opsin-free cells. Several complementary strategies can be used to increase the precision of optogenetic tagging of neurons, including the application of different waveform patterns, but perhaps more important is using minimum light intensities of focally applied light and monitoring the induced effects both locally and more distally from the light source (Fig. 5). Many of current technical problems of neuron identification and local circuit analysis arises from the use of large-diameter optical fibers (Cardin et al., 2010;Halassa et al., 2011;Han et al., 2009;Kravitz et al., 2010) or brain surface illumination (Huber et al., 2008;Lee et al., 2012;Moore and Wehr, 2013) at high light power. To activate neurons at a distance from a light source, high intensities (several mW or higher) are often used (Cardin et al., 2010;Halassa et al., 2011;Han et al., 2009;Huber et al., 2008;Kravitz et al., 2010;Moore and Wehr, 2013) . High-power photostimulation can generate photoelectric artifacts, activate/silence numerous neurons both directly and indirectly (Figure 5) and induce synchronous discharges in multiple neurons, making 'spike sorting' difficult or impossible. Such technical problems can be significantly reduced or eliminated by etching small-core ( less than =50 um) optical fibers to a point ( less than =10 um) and mounting them close ( less than 40-50 um) to the recording sites (Figure 6; (Royer et al., 2010;Stark et al., 2012)). Experiments have shown that less than 1 uW of light ( less than 0.1 mW/mm2) is sufficient to activate ChR2-expressing neurons in vivo (Stark et al., 2012;Stark et al., 2014), and with the development of more sensitive opsins (Chuong et al., 2014), light requirements are expected to decrease. Such hybrid devices can eliminate photoelectric artifacts and reduce artificially induced overlapping spikes. The low light intensity requirement can eliminate the need for bench top lasers and optical cables that restrain the freedom of the animal's movement. Instead, miniature light emitting diodes (LED) and/or laser diodes can be coupled to short, small-diameter (50 um) multimode fibers and attached directly to the shanks of a silicon probe or tetrode (Figure 6). The small size and weight of these integrated 'diode probes' allow fast, multisite and multicolor optogenetic manipulations in freely moving animals with concurrent monitoring of the manipulated neurons (Royer et al., 2010;Royer et al., 2012;Stark et al., 2012). To replace the labor-intensive manual process, at least two approaches are being tested. The first is the monolithic integration of all optical and electrical components on the shanks of the silicon probe (Wu et al., 2013;Zorzos et al., 2010). Various waveguide configurations can be designed with photolithography and the distances between optical stimulation sites and recording electrodes can be precisely determined (Zorzos et al., 2010;Zorzos et al., 2012). At a given stimulation site, different wavelengths can be selected by switching between the light sources and allowing fast and complex manipulation of neural activity by exciting and silencing of the same neurons (Stark et al., 2012). Another approach is placing an assembly of micro-light-emitting diodes (uLEDs) in the vicinity of the recording sites (Kim et al., 2013). Either configuration will offer unmatched spatial precision and capability of targeted perturbation and recording from specified neuron types. Dramatic reduction of light intensity combined with dense recording of the surrounding neurons allows single neuron stimulation (Fig. 7) and estimation of the absolute numbers of directly-driven neurons in a small illuminated volume. Being able to assess the fraction of neurons that can affect a particular physiological pattern, perception, memory or overt behavior is an important goal of neuronal circuit analysis. To be able to identify diverse components of circuits, an iterative refinement of a library of physiological parameters is needed so that subsequently the various neurons can be recognized reliably by using purely physiological criteria without the need for optogenetics (Kvitsiani et al., 2013;Madisen et al., 2012;Pi et al., 2013;Royer et al., 2012;Stark et al., 2013). We are only beginning to understand how different methods of light delivery impact different neuron types. A hitherto unexploited path for characterizing the physiological properties of optically-tagged neurons is their input-output analysis. By analogy to neuron characterization by intracellular current injections (Ascoli et al., 2008) localized optical stimulation can be used to activate neurons and observe their characteristic response properties to pulses, sinusoid, white noise stimuli or more complex patterns. Although the photobleaching and light adaptation properties of the various opsins (Lin et al., 2009) are currently a potential obstacle with bright light sources, the availability of faster reacting and highly sensitive opsins (Berndt et al., 2011;Chuong et al., 2014;Gunaydin et al., 2010;Klapoetke et al., 2014;Zhang et al., 2011) will reduce such concerns. Comparison of pyramidal cells and interneurons has already demonstrated that ChR2 expressing parvalbumin interneurons follow optical responses much more efficiently than neighboring pyramidal neurons (Stark et al., 2013). Further experiments may validate the utility of such waveform characterization methods of neuron identity. Overall, combining optogenetic manipulation with high-density electrophysiological monitoring can offer high fidelity identification of circuit components, a prerequisite for a rational perturbation of identified neuron types and quantities for understanding their impact in circuit function (Roux et al., 2014;Roux and Buzsaki, 2015). Perhaps the most critical goal of combining optogenetics with large-scale extracellular recordings is to identify the causal role of specific neuron classes in local circuit operations. Perturbation strategies can probe the involvement of particular neuron types in any defined computation, such as gain control, plasticity, oscillations, circuit stability and spike transfer modes. Closed-loop optogenetic activation or silencing of targeted neurons, combination of predetermined spike patterns in multiple cells contingent upon behavioral parameters, and/or selected features of the LFP can alter the timing of action potentials (Stark et al., 2013;Stark et al., 2012;Stark et al., 2014) and induce or suppress correlated firing between cells during movement, perception, leaning, memory, sleep or any other aspects of brain activity. Simultaneous monitoring of neuronal responses to optogenetic perturbation is critical for uncovering the mechanisms how each neuron type contributes to circuit performance. Optogenetics combined with large-scale extracellular recordings has already proven to be effective in studying the functional roles of specific GABAergic interneuron classes in both hippocampus and neocortex, as well as other brain regions (Alonso et al., 2012;Brown et al., 2012;Pi et al., 2013;Royer et al., 2012). Strong optogenetic activation of parvalbumin-expressing interneurons at gamma frequency was shown to coordinate the timing of sensory inputs relative to a gamma cycle and enhance signal transmission (Cardin et al., 2009;Carlen et al., 2012;Sohal et al., 2009), whereas at weaker activation produced theta resonance and excess spiking in nearby pyramidal cells (Stark et al., 2013). Local stimulation of pyramidal cells induced high frequency oscillations, typical of hippocampal ripples (Stark et al., 2014). Channelrhodopsin-2-assisted circuit analysis in the amygdala identified neurons critical in gating conditioned fear (Haubensak et al., 2010). Optogenetic activation of orexin neurons in the hypothalamus could change sleep choreography (de Lecea and Huerta, 2014). Periodic light stimulation of neurons of the thalamic reticular nucleus induced state-dependent neocortical spindles (Kravitz et al., 2010) or evoked generalized spike and wave discharges (Berenyi et al., 2012). On the other hand, tonic photoactivation of reticular neurons reduced focal seizures in the neocortex (Paz et al., 2013). Similarly, spontaneous seizures could be suppressed by optogenetic activation of parvalbumin interneurons in the hippocampus (Krook-Magnuson et al., 2013). Optogenetic activation of dentate gyrus neurons could induce false memories, making mice acting accordingly in a fear conditioning paradigm (Ramirez et al., 2013). This non-exhaustive list of experiments demonstrate the power of combined closed-loop recording-optogenetic methods for understanding complex neuronal interactions in intact and altered networks (Roux et al., 2014), and foretell how such methods could one day be harnessed for clinical applications. Good research practice stands on the foundation of accurate measurement. Our review has focused on the large-scale recording of neuronal spike data and the optogenetic manipulation of neurons, the appropriate combination of which can provide single neuron, single spike monitoring and control in behaving animals, not possible by other methods. Although several aspects of the combined recording/optogenetics technique are highly scalable and one can imagine exponential growth of the technology (Alivisatos et al., 2013;Marblestone et al., 2013), our aim was to discuss techniques that can be deployed currently or in the near future for the ultra-dense sampling of neuronal circuits. Combination of electrical recording and optogenetics with imaging (Grienberger and Konnerth, 2012;Yuste and Katz, 1991) can further enhance the power of these methods. Spectacular progress has been made over the past few years in signal multiplexing, moving from expensive and bulky modular amplifier-digitizer systems to affordable, high-channel count signal multiplexed systems ((Berenyi et al., 2014);http://www.intantech.com/;http://open-ephys.org/). There are no longer financial constraints even for small labs to record from a few hundred channels. It is expected that channel count will greatly increase in the coming years, paralleled with a substantial decrease in the size of signal multiplexing devices. Silicon probes with several dozens and even hundreds of sites are currently commercially available and probes with even higher channel counts in both two- and three-dimensional configurations are being tested experimentally (Du et al., 2009;Riera et al., 2012). To make these techniques fruitful for experiments on mice and other small size animals will require orders of magnitude improvement in several key parameters, particularly on-probe signal multiplexing (Olsson et al., 2005). Substantially improved power efficiency of telemetry and data loggers or their external powering may eventually eliminate the need for cable connections between the animal and recording equipment. A foreseeable challenge with brain embedded electronics is that the electromagnetic fields needed for external powering may ephaptically stimulate neurons. Miniaturization and improved stability of micromanipulators to allow long-term recordings from multiple brain regions simultaneously are equally important steps. Obtaining high-quality, high-density data from multiple interconnected structures is only the first necessary step. The second big challenge is to develop fast automatic or semi-automatic and validated algorithms for spike clustering with common standards to facilitate standardization and within- and across-laboratory replication of neuronal identification (Buzsaki, 2004;Einevoll et al., 2012). Finally, making sense of the large-scale and properly preprocessed data requires a further concerted effort (Packer et al., 2013). Effective dissemination of the newly developed methods and algorithms and sharing as well as maintaining well-curated data with common standards and seamless user accessibility ((Mizuseki et al., 2014);CRCNS.org) are among the key tasks ahead of us for advancing rapid progress. Successful analysis of neuronal circuits requires not only large-scale recording of neurons at high speed but also their interactive control at the single-neuron, single-spike level. While optogenetics has emerged as an appropriate method for manipulating identified neurons at sufficient speed, substantial improvement is needed to achieve the desired spatial resolution at the single neuron level. Such development will require the integration of silicon recording technology with the local and programmable delivery of light, using either waveguides or neuron-size LEDs mixed with the recording sites (Kim et al., 2013;Wu et al., 2013). Neuron identity can be obtained online by optogenetics. Multi-color techniques can be deployed for activating and silencing the same neurons in the behaving animal (Stark et al., 2012) and for selective perturbation of excitatory and inhibitory neurons. Optogenetic techniques are often cited as a solution for the long-waited mechanistic understanding of causal effects of neurons in their native environment (Boyden et al., 2005;Packer et al., 2013;Scanziani and Hausser, 2009). However, these aspects of optogenetics are often overstated since identifying the 'cause' by local perturbations in complex systems can be a daunting task. While tracking cause-effect relationships in linear systems (such as A causes B) is relatively straightforward, in complex systems with multiple re-entrant loops and emergent properties such as the brain, circuit perturbations can bring about multiple and hard-to-interpret consequences since A and B can have bidirectional or circular causal relationships. Because brain circuits are perpetually active and their components display qualitatively different interactions in different brain states, imposition of synthetic patterns has to compete with an ongoing brain-based program and can induce outcomes different from the native functions. These and other unexpected surprises of the perturbation technique (Miesenbock, 2009) emphasize the need for the focal delivery of light limited to the volume of recorded neurons and the application of control theory (Zhou et al., 1996). Despite these expected difficulties, multisite-multineuron close-loop control experiments offer unprecedented opportunities for the exploration of neuronal circuits. They can be used to induce, modify or annihilate network oscillations, test hypothesized rules of in vivo plasticity, examine the critical role of timing (e.g., by introducing controlled jitter of spike timing) and, perhaps most importantly, determine how synthetic spatiotemporal patterns of activity of identified neurons induce specific behaviors. This exercise amounts to understanding the neuronal syntax or brain coding.